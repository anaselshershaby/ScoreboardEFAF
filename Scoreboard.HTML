<!-- dashboard.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Firebase Score Dashboard</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=College&family=Varsity+Team&display=swap">
    <!-- Add Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-database.js"></script>
    <style>
        /* [Keep all previous CSS styles unchanged] */
    </style>
</head>
<body>
    <!-- [Keep all previous HTML structure unchanged] -->

    <script>
        // Your Firebase config (replace with your actual config)
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
            databaseURL: "https://YOUR_PROJECT_ID.firebaseio.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT_ID.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const scoreboardRef = db.ref('scoreboard');

        // Firebase-connected functions
        function createGameElements() {
            /* [Keep previous createGameElements implementation unchanged] */
        }

        function createTeamControl(game, team) {
            /* [Keep previous createTeamControl implementation unchanged] */
        }

        // Real-time Database Handlers
        function setupFirebaseListeners() {
            // Listen for score changes
            scoreboardRef.on('value', (snapshot) => {
                const data = snapshot.val() || {};
                this.syncFromFirebase(data);
            });
        }

        function syncFromFirebase(data) {
            // Update team names and scores
            document.querySelectorAll('.team-name, .team-score').forEach(input => {
                const { game, team } = input.dataset;
                const type = input.classList.contains('team-name') ? 'name' : 'score';
                const value = data?.[`game${game}`]?.[`team${team}`]?.[type] || '';
                if (input.value !== value) input.value = value;
            });

            // Update team logos
            document.querySelectorAll('.team-logo').forEach(img => {
                const [_, team, game] = img.id.split('-');
                const logo = data?.[`game${game}`]?.[`team${team}`]?.logo || '';
                if (img.src !== logo) img.src = logo;
            });

            // Update background
            const background = data?.background || '';
            if (document.body.style.backgroundImage !== `url(${background})`) {
                document.body.style.backgroundImage = background ? `url(${background})` : '';
            }
        }

        async function updateFirebase(path, value) {
            try {
                await db.ref(path).set(value);
            } catch (error) {
                console.error('Firebase update failed:', error);
            }
        }

        // Modified Event Handlers
        async function handleLogoUpload(e) {
            const { game, team } = e.target.dataset;
            const file = e.target.files[0];
            
            if (!file?.type.startsWith('image/')) {
                alert('Please upload an image file');
                return;
            }

            const reader = new FileReader();
            reader.onload = async (event) => {
                const logoPath = `game${game}/team${team}/logo`;
                await updateFirebase(logoPath, event.target.result);
            };
            reader.readAsDataURL(file);
        }

        async function handleScoreAdjust(e) {
            const points = parseInt(e.target.dataset.points);
            const scoreInput = e.target.closest('.points-buttons').previousElementSibling;
            const { game, team } = scoreInput.dataset;
            
            const newScore = Math.max(0, parseInt(scoreInput.value) + points;
            await updateFirebase(`game${game}/team${team}/score`, newScore);
        }

        async function handleReset(e) {
            const scoreInput = e.target.previousElementSibling.querySelector('.team-score');
            const { game, team } = scoreInput.dataset;
            await updateFirebase(`game${game}/team${team}/score`, 0);
        }

        // Modified Background Handling
        document.getElementById('backgroundUpload').addEventListener('change', async function(e) {
            const file = e.target.files[0];
            if (!file?.type.startsWith('image/')) {
                alert('Please upload an image file');
                return;
            }

            const reader = new FileReader();
            reader.onload = async (event) => {
                await updateFirebase('background', event.target.result);
            };
            reader.readAsDataURL(file);
        });

        async function clearBackground() {
            await updateFirebase('background', '');
        }

        // Initialize Application
        document.addEventListener('DOMContentLoaded', () => {
            createGameElements();
            setupFirebaseListeners();
            
            // Event Delegation (keep previous implementation unchanged)
            document.addEventListener('change', e => {
                if (e.target.matches('.logo-upload')) handleLogoUpload(e);
                if (e.target.matches('.team-name')) {
                    const { game, team } = e.target.dataset;
                    updateFirebase(`game${game}/team${team}/name`, e.target.value);
                }
                if (e.target.matches('.team-score')) {
                    const { game, team } = e.target.dataset;
                    const value = Math.max(0, parseInt(e.target.value) || 0);
                    updateFirebase(`game${game}/team${team}/score`, value);
                }
            });

            document.addEventListener('click', e => {
                if (e.target.matches('.points-buttons button')) handleScoreAdjust(e);
                if (e.target.matches('.reset-button')) handleReset(e);
            });
        });
    </script>
</body>
</html>
