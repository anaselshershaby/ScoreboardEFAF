<!-- dashboard.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Control Dashboard</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=College&family=Varsity+Team&display=swap">
    <style>
        :root {
            --college-font: 'Varsity Team', 'College', Impact, sans-serif;
        }

        body {
            font-family: var(--college-font);
            background: #2F4F4F;
            color: white;
            text-align: center;
            margin: 0;
            padding: 20px;
        }

        .dashboard-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }

        .game-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 90%;
            max-width: 1000px;
            background: #333;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid white;
        }

        .team-control {
            background: #444;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            flex: 1;
        }

        .team-title {
            font-size: 24px;
            font-weight: bold;
        }

        input[type="text"], input[type="number"] {
            font-family: var(--college-font);
            font-size: 20px;
            width: 80%;
            padding: 8px;
            margin: 5px 0;
            border: 2px solid white;
            border-radius: 5px;
            text-align: center;
        }

        .points-buttons button, .reset-button {
            font-family: var(--college-font);
            font-size: 18px;
            padding: 8px 15px;
            background: #1E90FF;
            border: none;
            border-radius: 8px;
            margin: 5px;
            cursor: pointer;
        }

        .reset-button {
            background: #FF4500;
        }

        .upload-container {
            margin-bottom: 20px;
        }

        .upload-container input {
            padding: 10px;
            border-radius: 5px;
            background: white;
            color: black;
        }

        .team-logo {
            width: 50px;
            height: 50px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <h1>Score Control Dashboard</h1>
        <div class="upload-container">
            <label for="backgroundUpload">Upload Background:</label>
            <input type="file" id="backgroundUpload" accept="image/*" onchange="uploadBackground()">
            <button onclick="clearBackground()" class="reset-button">Clear Background</button>
        </div>

        <script>
            for (let game = 1; game <= 3; game++) {
                document.write(`
                    <div class="game-row">
                        <div class="team-control">
                            <div class="team-title">Home</div>
                            <img id="logo1-game${game}" class="team-logo" src="" alt="Home Team Logo">
                            <input type="file" id="logo1-upload-game${game}" accept="image/*" onchange="uploadTeamLogo(${game}, 1)">
                            <input type="text" id="name1-game${game}" placeholder="Home Team ${game}" oninput="updateTeamName(${game}, 1, this.value)">
                            <input type="number" id="score1-game${game}" value="0" oninput="updateScore(${game}, 1, this.value)">
                            <div class="points-buttons">
                                <button onclick="adjustScore(${game}, 1, 1)">+1</button>
                                <button onclick="adjustScore(${game}, 1, 2)">+2</button>
                                <button onclick="adjustScore(${game}, 1, 6)">+6</button>
                            </div>
                            <button class="reset-button" onclick="resetScore(${game}, 1)">Reset</button>
                        </div>
                        <h2>Game ${game}</h2>
                        <div class="team-control">
                            <div class="team-title">Away</div>
                            <img id="logo2-game${game}" class="team-logo" src="" alt="Away Team Logo">
                            <input type="file" id="logo2-upload-game${game}" accept="image/*" onchange="uploadTeamLogo(${game}, 2)">
                            <input type="text" id="name2-game${game}" placeholder="Away Team ${game}" oninput="updateTeamName(${game}, 2, this.value)">
                            <input type="number" id="score2-game${game}" value="0" oninput="updateScore(${game}, 2, this.value)">
                            <div class="points-buttons">
                                <button onclick="adjustScore(${game}, 2, 1)">+1</button>
                                <button onclick="adjustScore(${game}, 2, 2)">+2</button>
                                <button onclick="adjustScore(${game}, 2, 6)">+6</button>
                            </div>
                            <button class="reset-button" onclick="resetScore(${game}, 2)">Reset</button>
                        </div>
                    </div>
                `);
            }

        </script>
    </div>
<script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <script>
        function uploadTeamLogo(game, team) {
            const file = document.getElementById(`logo${team}-upload-game${game}`).files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    localStorage.setItem(`team-logo-${team}-game${game}`, e.target.result);
                    document.getElementById(`logo${team}-game${game}`).src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        }

        function updateTeamName(game, team, name) {
            localStorage.setItem(`team-name-${team}-game${game}`, name);
        }

        function updateScore(game, team, score) {
            localStorage.setItem(`team-score-${team}-game${game}`, score);
        }

        function adjustScore(game, team, points) {
            const scoreElement = document.getElementById(`score${team}-game${game}`);
            let score = parseInt(scoreElement.value) + points;
            scoreElement.value = score;
            updateScore(game, team, score);
        }

        function resetScore(game, team) {
            document.getElementById(`score${team}-game${game}`).value = 0;
            updateScore(game, team, 0);
        }

        function uploadBackground() {
            const file = document.getElementById('backgroundUpload').files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.body.style.backgroundImage = `url(${e.target.result})`;
                    localStorage.setItem('background-image', e.target.result);
                };
                reader.readAsDataURL(file);
            }
        }

        function clearBackground() {
            document.body.style.backgroundImage = '';
            localStorage.removeItem('background-image');
        }

        window.addEventListener('load', () => {
            for (let game = 1; game <= 3; game++) {
                for (let team = 1; team <= 2; team++) {
                    const logo = localStorage.getItem(`team-logo-${team}-game${game}`);
                    if (logo) {
                        document.getElementById(`logo${team}-game${game}`).src = logo;
                    }
                    const name = localStorage.getItem(`team-name-${team}-game${game}`);
                    if (name) {
                        document.getElementById(`name${team}-game${game}`).value = name;
                    }
                    const score = localStorage.getItem(`team-score-${team}-game${game}`);
                    if (score) {
                        document.getElementById(`score${team}-game${game}`).value = score;
                    }
                }
            }
            const background = localStorage.getItem('background-image');
            if (background) {
                document.body.style.backgroundImage = `url(${background})`;
            }
        });
 // Update these functions to match scoreboard's key pattern
    function updateTeamName(game, team, name) {
        localStorage.setItem(`name-${team}-${game}`, name);
        window.dispatchEvent(new Event('storage'));
    }

    function updateScore(game, team, score) {
        localStorage.setItem(`score-${team}-${game}`, score);
        window.dispatchEvent(new Event('storage'));
    }

    function adjustScore(game, team, points) {
        const scoreElement = document.getElementById(`score${team}-game${game}`);
        let score = parseInt(scoreElement.value) + points;
        scoreElement.value = score;
        updateScore(game, team, score);
    }

    function resetScore(game, team) {
        document.getElementById(`score${team}-game${game}`).value = 0;
        updateScore(game, team, 0);
    }

    // Update background storage key to match scoreboard
    function uploadBackground() {
        const file = document.getElementById('backgroundUpload').files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                document.body.style.backgroundImage = `url(${e.target.result})`;
                localStorage.setItem('scoreboard-background', e.target.result);
            };
            reader.readAsDataURL(file);
        }
    }

    window.addEventListener('load', () => {
        // Load existing data with correct key pattern
        for (let game = 1; game <= 3; game++) {
            for (let team = 1; team <= 2; team++) {
                const logo = localStorage.getItem(`team-logo-${team}-game${game}`);
                if (logo) {
                    document.getElementById(`logo${team}-game${game}`).src = logo;
                }
                const name = localStorage.getItem(`name-${team}-${game}`);
                if (name) {
                    document.getElementById(`name${team}-game${game}`).value = name;
                }
                const score = localStorage.getItem(`score-${team}-${game}`);
                if (score) {
                    document.getElementById(`score${team}-game${game}`).value = score;
                }
            }
        }
        const background = localStorage.getItem('scoreboard-background');
        if (background) {
            document.body.style.backgroundImage = `url(${background})`;
        }
    });

    </script>

<script>
    let peer;
    let conn;

    // Initialize PeerJS (host)
    function initializeHost() {
        const hostId = "dashboard-host"; // Unique ID for the host
        peer = new Peer(hostId);

        peer.on("open", (id) => {
            console.log("Host ID:", id);
        });

        // Listen for connections from peers
        peer.on("connection", (connection) => {
            conn = connection;
            console.log("Scoreboard connected:", connection.peer);

            // Send initial data to the scoreboard
            conn.send({ type: "init", data: getCurrentData() });

            // Listen for messages from the scoreboard
            conn.on("data", (data) => {
                console.log("Received from scoreboard:", data);
            });
        });
    }

    // Send updates to the scoreboard
    function sendUpdate(data) {
        if (conn && conn.open) {
            conn.send({ type: "update", data });
        }
    }

    // Example: Update team name
    function updateTeamName(game, team, name) {
        const data = { game, team, name };
        sendUpdate(data);
    }

    // Example: Update team score
    function updateScore(game, team, score) {
        const data = { game, team, score };
        sendUpdate(data);
    }

    // Get current data (for initialization)
    function getCurrentData() {
        const data = {};
        for (let game = 1; game <= 3; game++) {
            for (let team = 1; team <= 2; team++) {
                data[`name-${team}-${game}`] = document.getElementById(`name${team}-game${game}`).value;
                data[`score-${team}-${game}`] = document.getElementById(`score${team}-game${game}`).value;
            }
        }
        return data;
    }

    // Initialize the host when the page loads
    window.addEventListener("load", initializeHost);
</script>
<script>
    let peer;
    let conn;

    // Initialize PeerJS (peer)
    function initializePeer() {
        const peerId = "scoreboard-peer"; // Unique ID for the peer
        peer = new Peer(peerId);

        peer.on("open", (id) => {
            console.log("Peer ID:", id);
            connectToHost();
        });

        // Connect to the host
        function connectToHost() {
            const hostId = "dashboard-host"; // Host ID
            conn = peer.connect(hostId);

            conn.on("open", () => {
                console.log("Connected to host:", hostId);

                // Listen for messages from the host
                conn.on("data", (data) => {
                    if (data.type === "init") {
                        // Initialize scoreboard with current data
                        updateScoreboard(data.data);
                    } else if (data.type === "update") {
                        // Update specific data
                        handleUpdate(data.data);
                    }
                });
            });
        }
    }

    // Update the scoreboard with new data
    function updateScoreboard(data) {
        for (let game = 1; game <= 3; game++) {
            for (let team = 1; team <= 2; team++) {
                document.getElementById(`name${team}-game${game}`).textContent = data[`name-${team}-${game}`] || `Team ${team} ${game}`;
                document.getElementById(`score${team}-game${game}`).textContent = data[`score-${team}-${game}`] || 0;
            }
        }
    }

    // Handle updates from the host
    function handleUpdate(data) {
        if (data.game && data.team) {
            if (data.name) {
                document.getElementById(`name${data.team}-game${data.game}`).textContent = data.name;
            }
            if (data.score) {
                document.getElementById(`score${data.team}-game${data.game}`).textContent = data.score;
            }
        }
    }

    // Initialize the peer when the page loads
    window.addEventListener("load", initializePeer);
</script>
<script>
function adjustScore(game, team, points) {
    let scoreRef = db.ref(`games/game${game}/team${team}/score`);
    scoreRef.once("value").then(snapshot => {
        let newScore = (snapshot.val() || 0) + points;
        if (newScore < 0) newScore = 0;
        scoreRef.set(newScore);
    });
}

function updateTeamName(game, team, newName) {
    db.ref(`games/game${game}/team${team}/name`).set(newName);
}
</script>

</body>
</html>
