<!-- dashboard.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Control Dashboard</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=College&family=Varsity+Team&display=swap">
    <style>
        :root {
            --college-font: 'Varsity Team', 'College', Impact, sans-serif;
        }

        body {
            font-family: var(--college-font);
            background: #2F4F4F;
            color: white;
            text-align: center;
            margin: 0;
            padding: 20px;
        }

        .dashboard-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }

        .game-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 90%;
            max-width: 1000px;
            background: #333;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid white;
        }

        .team-control {
            background: #444;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            flex: 1;
        }

        .team-title {
            font-size: 24px;
            font-weight: bold;
        }

        input[type="text"], input[type="number"] {
            font-family: var(--college-font);
            font-size: 20px;
            width: 80%;
            padding: 8px;
            margin: 5px 0;
            border: 2px solid white;
            border-radius: 5px;
            text-align: center;
        }

        .points-buttons button, .reset-button {
            font-family: var(--college-font);
            font-size: 18px;
            padding: 8px 15px;
            background: #1E90FF;
            border: none;
            border-radius: 8px;
            margin: 5px;
            cursor: pointer;
        }

        .reset-button {
            background: #FF4500;
        }

        .upload-container {
            margin-bottom: 20px;
        }

        .upload-container input {
            padding: 10px;
            border-radius: 5px;
            background: white;
            color: black;
        }

        .team-logo {
            width: 50px;
            height: 50px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <h1>Score Control Dashboard</h1>
        <div class="upload-container">
            <label for="backgroundUpload">Upload Background:</label>
            <input type="file" id="backgroundUpload" accept="image/*" onchange="uploadBackground()">
            <button onclick="clearBackground()" class="reset-button">Clear Background</button>
        </div>

        <script>
            for (let game = 1; game <= 3; game++) {
                document.write(`
                    <div class="game-row">
                        <div class="team-control">
                            <div class="team-title">Home</div>
                            <img id="logo1-game${game}" class="team-logo" src="" alt="Home Team Logo">
                            <input type="file" id="logo1-upload-game${game}" accept="image/*" onchange="uploadTeamLogo(${game}, 1)">
                            <input type="text" id="name1-game${game}" placeholder="Home Team ${game}" oninput="updateTeamName(${game}, 1, this.value)">
                            <input type="number" id="score1-game${game}" value="0" oninput="updateScore(${game}, 1, this.value)">
                            <div class="points-buttons">
                                <button onclick="adjustScore(${game}, 1, 1)">+1</button>
                                <button onclick="adjustScore(${game}, 1, 2)">+2</button>
                                <button onclick="adjustScore(${game}, 1, 6)">+6</button>
                            </div>
                            <button class="reset-button" onclick="resetScore(${game}, 1)">Reset</button>
                        </div>
                        <h2>Game ${game}</h2>
                        <div class="team-control">
                            <div class="team-title">Away</div>
                            <img id="logo2-game${game}" class="team-logo" src="" alt="Away Team Logo">
                            <input type="file" id="logo2-upload-game${game}" accept="image/*" onchange="uploadTeamLogo(${game}, 2)">
                            <input type="text" id="name2-game${game}" placeholder="Away Team ${game}" oninput="updateTeamName(${game}, 2, this.value)">
                            <input type="number" id="score2-game${game}" value="0" oninput="updateScore(${game}, 2, this.value)">
                            <div class="points-buttons">
                                <button onclick="adjustScore(${game}, 2, 1)">+1</button>
                                <button onclick="adjustScore(${game}, 2, 2)">+2</button>
                                <button onclick="adjustScore(${game}, 2, 6)">+6</button>
                            </div>
                            <button class="reset-button" onclick="resetScore(${game}, 2)">Reset</button>
                        </div>
                    </div>
                `);
            }
        </script>
    </div>

   <script>
        // Firebase configuration (replace with your actual values)
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
            databaseURL: "https://YOUR_PROJECT_ID.firebaseio.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT_ID.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const scoreboardRef = db.ref('scoreboard');

        // Modified Storage Management for Firebase
        function getFirebasePath(game, team, type) {
            return `game${game}/team${team}/${type}`;
        }

        // Modified Event Handlers for Firebase
        async function handleLogoUpload(e) {
            const { game, team } = e.target.dataset;
            const file = e.target.files[0];
            
            if (!file?.type.startsWith('image/')) {
                alert('Please upload an image file');
                return;
            }

            const reader = new FileReader();
            reader.onload = async (event) => {
                const path = getFirebasePath(game, team, 'logo');
                await db.ref(path).set(event.target.result);
            };
            reader.readAsDataURL(file);
        }

        async function handleScoreAdjust(e) {
            const points = parseInt(e.target.dataset.points);
            const scoreInput = e.target.closest('.points-buttons').previousElementSibling;
            const { game, team } = scoreInput.dataset;
            
            const newScore = Math.max(0, parseInt(scoreInput.value) + points);
            const path = getFirebasePath(game, team, 'score');
            await db.ref(path).set(newScore);
        }

        async function handleReset(e) {
            const scoreInput = e.target.previousElementSibling.querySelector('.team-score');
            const { game, team } = scoreInput.dataset;
            const path = getFirebasePath(game, team, 'score');
            await db.ref(path).set(0);
        }

        // Modified Background Handling
        document.getElementById('backgroundUpload').addEventListener('change', async function(e) {
            const file = e.target.files[0];
            if (!file?.type.startsWith('image/')) {
                alert('Please upload an image file');
                return;
            }

            const reader = new FileReader();
            reader.onload = async (event) => {
                await db.ref('background').set(event.target.result);
            };
            reader.readAsDataURL(file);
        });

        async function clearBackground() {
            await db.ref('background').set('');
        }

        // Real-time Sync from Firebase
        function setupFirebaseListeners() {
            // Listen for all scoreboard changes
            scoreboardRef.on('value', (snapshot) => {
                const data = snapshot.val() || {};
                syncFromFirebase(data);
            });
        }

        function syncFromFirebase(data) {
            // Update team names
            document.querySelectorAll('.team-name').forEach(input => {
                const { game, team } = input.dataset;
                const value = data?.[`game${game}`]?.[`team${team}`]?.name || '';
                if (input.value !== value) input.value = value;
            });

            // Update scores
            document.querySelectorAll('.team-score').forEach(input => {
                const { game, team } = input.dataset;
                const value = data?.[`game${game}`]?.[`team${team}`]?.score || 0;
                if (input.value !== value.toString()) input.value = value;
            });

            // Update logos
            document.querySelectorAll('.team-logo').forEach(img => {
                const [_, team, game] = img.id.split('-');
                const logo = data?.[`game${game}`]?.[`team${team}`]?.logo || '';
                if (img.src !== logo) img.src = logo;
            });

            // Update background
            const background = data?.background || '';
            if (document.body.style.backgroundImage !== `url(${background})`) {
                document.body.style.backgroundImage = background ? `url(${background})` : '';
            }
        }

        // Initialize Application
        document.addEventListener('DOMContentLoaded', () => {
            createGameElements();
            setupFirebaseListeners();
            
            // Event Delegation
            document.addEventListener('change', e => {
                if (e.target.matches('.logo-upload')) handleLogoUpload(e);
                if (e.target.matches('.team-name')) {
                    const { game, team } = e.target.dataset;
                    db.ref(getFirebasePath(game, team, 'name')).set(e.target.value);
                }
                if (e.target.matches('.team-score')) {
                    const { game, team } = e.target.dataset;
                    const value = Math.max(0, parseInt(e.target.value) || 0);
                    db.ref(getFirebasePath(game, team, 'score')).set(value);
                }
            });

            document.addEventListener('click', e => {
                if (e.target.matches('.points-buttons button')) handleScoreAdjust(e);
                if (e.target.matches('.reset-button')) handleReset(e);
            });
        });
    </script>
</body>
</html>

</body>
</html>
